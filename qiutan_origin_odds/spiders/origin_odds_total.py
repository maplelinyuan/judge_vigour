# -*- coding: utf-8 -*-
import scrapy
import pdb
from qiutan_origin_odds.items import QiutanOriginOddsItem
from scrapy_splash import SplashRequest
from qiutan_origin_odds.spiders.tools import MyTools
from scrapy_redis.spiders import RedisSpider
from pymongo import MongoClient
import traceback
import time
import redis


# 参数
Sa = 10
Sb = 3

# scrapy crawl origin_odds
# class OriginOddsSpider(scrapy.Spider):
class OriginOddsSpider(RedisSpider):
    # name = 'origin_odds'
    allowed_domains = ['http://zq.win007.com']
    start_urls = []
    redis_key = 'qiutan_analysis:start_urls'
    global splashurl
    splashurl = "http://192.168.99.100:8050/render.html"


    # def start_requests(self):
    #     for url in self.start_urls:
    #         yield scrapy.Request(url)
    # # 此处是重父类方法，并使把url传给splash解析
    def make_requests_from_url(self, url):
        global splashurl
        url = splashurl + "?url=" + url
        # 使用代理访问
        proxy = MyTools.get_proxy()
        LUA_SCRIPT = """
                            function main(splash)
                                splash:on_request(function(request)
                                    request:set_proxy{
                                        host = "%(host)s",
                                        port = %(port)s,
                                        username = '', password = '', type = "HTTPS",
                                    }
                                    request:set_header('X-Forwarded-For', %(proxy_ip)s)
                                end)
                                assert(splash:go(args.url))
                                assert(splash:wait(1))
                                return {
                                    html = splash:html(),
                                }
                            end
                            """
        try:
            proxy_host = proxy.strip().split(':')[0]
            proxy_port = int(proxy.strip().split(':')[-1])
            LUA_SCRIPT = LUA_SCRIPT % {'host': proxy_host, 'port': proxy_port, 'proxy_ip': proxy_host}
            print('make_requests代理为：', "http://{}".format(proxy))
            return SplashRequest(url, self.parse,
                                 args={'wait': 0.5, 'images': 0, 'timeout': 30, 'lua_source': LUA_SCRIPT},
                                 dont_filter=True)
        except Exception as err:
            MyTools.delete_proxy(proxy)
            print('%s\n%s' % (err, traceback.format_exc()))

    def start_requests(self):
        for url in self.start_urls:
            # 使用代理访问
            proxy = MyTools.get_proxy()

            LUA_SCRIPT = """
                        function main(splash)
                            splash:on_request(function(request)
                                request:set_proxy{
                                    host = "%(host)s",
                                    port = %(port)s,
                                    username = '', password = '', type = "HTTPS",
                                }
                                request:set_header('X-Forwarded-For', %(proxy_ip)s)
                            end)
                            assert(splash:go(args.url))
                            assert(splash:wait(1))
                            return {
                                html = splash:html(),
                            }
                        end
                        """
            proxy_host = proxy.strip().split(':')[0]
            proxy_port = int(proxy.strip().split(':')[-1])
            LUA_SCRIPT = LUA_SCRIPT % {'host': proxy_host, 'port': proxy_port, 'proxy_ip': proxy_host}
            try:
                print('初始代理为：', "http://{}".format(proxy))
                yield SplashRequest(url, self.parse, args={'wait': 0.5, 'images': 0, 'timeout': 30, 'lua_source': LUA_SCRIPT}, dont_filter=True)
            except Exception as err:
                MyTools.delete_proxy(proxy)
                print('%s\n%s' % (err, traceback.format_exc()))
    #
    # '''
    #     redis中存储的为set类型的公司名称，使用SplashRequest去请求网页。
    #     注意：不能在make_request_from_data方法中直接使用SplashRequest（其他第三方的也不支持）,会导致方法无法执行，也不抛出异常
    #     但是同时重写make_request_from_data和make_requests_from_url方法则可以执行
    # '''

    def parse(self, response):
        try:
            match_id = response.url.split('/')[-1].split('.')[0]
            # home_team_id = response.xpath('//div[@class="home"]').xpath('a/@href').extract()[0].split('/')[-1].split('.')[0]
            # away_team_id = response.xpath('//div[@class="guest"]').xpath('a/@href').extract()[0].split('/')[-1].split('.')[0]
            # 赔率部分
            bet_365_origin_tr = response.xpath('//tr[@id="tr_o_1_8"]/td')
            bet_365_last_tr = response.xpath('//tr[@id="tr_o_2_8"]/td')
            bet365_home_origin_odd = float(bet_365_origin_tr[2].xpath('text()').extract()[0])
            bet365_draw_origin_odd = float(bet_365_origin_tr[3].xpath('text()').extract()[0])
            bet365_away_origin_odd = float(bet_365_origin_tr[4].xpath('text()').extract()[0])
            bet365_home_last_odd = float(bet_365_last_tr[1].xpath('text()').extract()[0])
            bet365_draw_last_odd = float(bet_365_last_tr[2].xpath('text()').extract()[0])
            bet365_away_last_odd = float(bet_365_last_tr[3].xpath('text()').extract()[0])
            bet365_origin_home_handicap = float(bet_365_origin_tr[8].xpath('text()').extract()[0])
            bet365_origin_handicap = MyTools.convert_handicap(bet_365_origin_tr[9].xpath('text()').extract()[0])
            bet365_origin_away_handicap = float(bet_365_origin_tr[10].xpath('text()').extract()[0])
            bet365_last_home_handicap = float(bet_365_last_tr[7].xpath('text()').extract()[0])
            bet365_last_handicap = MyTools.convert_handicap(bet_365_last_tr[8].xpath('text()').extract()[0])
            bet365_last_away_handicap = float(bet_365_last_tr[9].xpath('text()').extract()[0])
            bet365_origin_over = float(bet_365_origin_tr[11].xpath('text()').extract()[0])
            bet365_origin_goal_handicap = MyTools.convert_goal_handicap(bet_365_origin_tr[12].xpath('text()').extract()[0])
            bet365_origin_under = float(bet_365_origin_tr[13].xpath('text()').extract()[0])
            bet365_last_over = float(bet_365_last_tr[10].xpath('text()').extract()[0])
            bet365_last_goal_handicap = MyTools.convert_goal_handicap(bet_365_last_tr[11].xpath('text()').extract()[0])
            bet365_last_under = float(bet_365_last_tr[12].xpath('text()').extract()[0])
            ladbrokes_origin_tr = response.xpath('//tr[@id="tr_o_1_4"]/td')
            ladbrokes_last_tr = response.xpath('//tr[@id="tr_o_2_4"]/td')
            ladbrokes_home_origin_odd = float(ladbrokes_origin_tr[2].xpath('text()').extract()[0])
            ladbrokes_draw_origin_odd = float(ladbrokes_origin_tr[3].xpath('text()').extract()[0])
            ladbrokes_away_origin_odd = float(ladbrokes_origin_tr[4].xpath('text()').extract()[0])
            ladbrokes_home_last_odd = float(ladbrokes_last_tr[1].xpath('text()').extract()[0])
            ladbrokes_draw_last_odd = float(ladbrokes_last_tr[2].xpath('text()').extract()[0])
            ladbrokes_away_last_odd = float(ladbrokes_last_tr[3].xpath('text()').extract()[0])
            ladbrokes_origin_home_handicap = float(ladbrokes_origin_tr[8].xpath('text()').extract()[0])
            ladbrokes_origin_handicap = MyTools.convert_handicap(ladbrokes_origin_tr[9].xpath('text()').extract()[0])
            ladbrokes_origin_away_handicap = float(ladbrokes_origin_tr[10].xpath('text()').extract()[0])
            ladbrokes_last_home_handicap = float(ladbrokes_last_tr[7].xpath('text()').extract()[0])
            ladbrokes_last_handicap = MyTools.convert_handicap(ladbrokes_last_tr[8].xpath('text()').extract()[0])
            ladbrokes_last_away_handicap = float(ladbrokes_last_tr[9].xpath('text()').extract()[0])
            ladbrokes_origin_over = float(ladbrokes_origin_tr[11].xpath('text()').extract()[0])
            ladbrokes_origin_goal_handicap = MyTools.convert_goal_handicap(ladbrokes_origin_tr[12].xpath('text()').extract()[0])
            ladbrokes_origin_under = float(ladbrokes_origin_tr[13].xpath('text()').extract()[0])
            ladbrokes_last_over = float(ladbrokes_last_tr[10].xpath('text()').extract()[0])
            ladbrokes_last_goal_handicap = MyTools.convert_goal_handicap(ladbrokes_last_tr[11].xpath('text()').extract()[0])
            ladbrokes_last_under = float(ladbrokes_last_tr[12].xpath('text()').extract()[0])
            # 赔率部分
            # 积分部分
            home_total_match = float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[0].xpath('table/tbody/tr')[2].xpath('td')[1].xpath('text()').extract()[0])
            home_total_point = float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[0].xpath('table/tbody/tr')[2].xpath('td')[8].xpath('text()').extract()[0])
            home_win_pro = round(float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[0].xpath('table/tbody/tr')[2].xpath('td')[-1].xpath('text()').extract()[0].split('%')[0])/100, 3)
            away_total_match = float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[1].xpath('table/tbody/tr')[2].xpath('td')[1].xpath('text()').extract()[0])
            away_total_point = float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[1].xpath('table/tbody/tr')[2].xpath('td')[8].xpath('text()').extract()[0])
            away_win_pro = round(float(response.xpath('//div[@id="porlet_5"]/div/table/tbody/tr/td')[1].xpath('table/tbody/tr')[2].xpath('td')[-1].xpath('text()').extract()[0].split('%')[0])/100, 3)
            # 积分部分
            # 近况部分

            home_latest_total = int(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[0].xpath('text()').extract()[0])
            home_latest_win_pro = round(int(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[0].xpath('text()').extract()[0]) / home_latest_total, 3)
            home_latest_draw_pro = round(int(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[1].xpath('text()').extract()[0]) / home_latest_total, 3)
            home_latest_away_pro = round(int(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[2].xpath('text()').extract()[0]) / home_latest_total, 3)
            home_latest_win_handicap_pro = round(float(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[1].xpath('span/text()').extract()[0].split('%')[0]) / 100, 3)
            home_latest_big_goal_pro = round(float(response.xpath('//table[@id="table_hn"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[2].xpath('span/text()').extract()[0].split('%')[0]) / 100, 3)

            away_latest_total = int(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[0].xpath('text()').extract()[0])
            away_latest_win_pro = round(int(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[0].xpath('text()').extract()[0]) / away_latest_total, 3)
            away_latest_draw_pro = round(int(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[1].xpath('text()').extract()[0]) / away_latest_total, 3)
            away_latest_away_pro = round(int(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/span')[2].xpath('text()').extract()[0]) / away_latest_total, 3)
            away_latest_win_handicap_pro = round(float(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[1].xpath('span/text()').extract()[0].split('%')[0]) / 100, 3)
            away_latest_big_goal_pro = round(float(response.xpath('//table[@id="table_an"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[2].xpath('span/text()').extract()[0].split('%')[0]) / 100, 3)
            # 近况部分
            # 交锋部分
            jiaofeng_total = int(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[0].xpath('text()').extract()[0])
            jiaofeng_home_pro = round(int(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[1].xpath('span/text()').extract()[0]) / jiaofeng_total, 3)
            jiaofeng_draw_pro = round(int(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[2].xpath('span/text()').extract()[0]) / jiaofeng_total, 3)
            jiaofeng_away_pro = round(int(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[3].xpath('span/text()').extract()[0]) / jiaofeng_total, 3)
            jiaofeng_win_handicap_pro = round(float(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[5].xpath('span/text()').extract()[0].split('%')[0])/100, 3)
            jiaofeng_big_goal_pro = round(float(response.xpath('//table[@id="table_v"]/tbody/tr[@align="center"]')[-1].xpath('td/font')[6].xpath('span/text()').extract()[0].split('%')[0])/100, 3)
            # 交锋部分

        except Exception as err:
            print('%s\n%s' % (err, traceback.format_exc()))
            r = redis.Redis(host='localhost', port=6381, db=0)
            return_url = response.url.split('?')[1].split('=')[1]
            r.lpush('qiutan_analysis:start_urls', return_url)
            print('重新推入队列！！！%s' % return_url)
            return False
            # pdb.set_trace()

        single_match_item = QiutanOriginOddsItem()
        single_match_item['match_id'] = match_id
        single_match_item['bet365_home_origin_odd'] = bet365_home_origin_odd
        single_match_item['bet365_draw_origin_odd'] = bet365_draw_origin_odd
        single_match_item['bet365_away_origin_odd'] = bet365_away_origin_odd
        single_match_item['bet365_home_last_odd'] = bet365_home_last_odd
        single_match_item['bet365_draw_last_odd'] = bet365_draw_last_odd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        single_match_item['bet365_away_last_odd'] = bet365_away_last_odd
        single_match_item['bet365_origin_home_handicap'] = bet365_origin_home_handicap
        single_match_item['bet365_origin_handicap'] = bet365_origin_handicap
        single_match_item['bet365_origin_away_handicap'] = bet365_origin_away_handicap
        single_match_item['bet365_last_home_handicap'] = bet365_last_home_handicap
        single_match_item['bet365_last_handicap'] = bet365_last_handicap
        single_match_item['bet365_last_away_handicap'] = bet365_last_away_handicap
        single_match_item['bet365_origin_over'] = bet365_origin_over
        single_match_item['bet365_origin_goal_handicap'] = bet365_origin_goal_handicap
        single_match_item['bet365_origin_under'] = bet365_origin_under
        single_match_item['bet365_last_over'] = bet365_last_over
        single_match_item['bet365_last_goal_handicap'] = bet365_last_goal_handicap
        single_match_item['bet365_last_under'] = bet365_last_under
        single_match_item['ladbrokes_home_origin_odd'] = ladbrokes_home_origin_odd
        single_match_item['ladbrokes_draw_origin_odd'] = ladbrokes_draw_origin_odd
        single_match_item['ladbrokes_away_origin_odd'] = ladbrokes_away_origin_odd
        single_match_item['ladbrokes_home_last_odd'] = ladbrokes_home_last_odd
        single_match_item['ladbrokes_draw_last_odd'] = ladbrokes_draw_last_odd
        single_match_item['ladbrokes_away_last_odd'] = ladbrokes_away_last_odd
        single_match_item['ladbrokes_origin_home_handicap'] = ladbrokes_origin_home_handicap
        single_match_item['ladbrokes_origin_handicap'] = ladbrokes_origin_handicap
        single_match_item['ladbrokes_origin_away_handicap'] = ladbrokes_origin_away_handicap
        single_match_item['ladbrokes_last_home_handicap'] = ladbrokes_last_home_handicap
        single_match_item['ladbrokes_last_handicap'] = ladbrokes_last_handicap
        single_match_item['ladbrokes_last_away_handicap'] = ladbrokes_last_away_handicap
        single_match_item['ladbrokes_origin_over'] = ladbrokes_origin_over
        single_match_item['ladbrokes_origin_goal_handicap'] = ladbrokes_origin_goal_handicap
        single_match_item['ladbrokes_origin_under'] = ladbrokes_origin_under
        single_match_item['ladbrokes_last_over'] = ladbrokes_last_over
        single_match_item['ladbrokes_last_goal_handicap'] = ladbrokes_last_goal_handicap
        single_match_item['ladbrokes_last_under'] = ladbrokes_last_under
        single_match_item['home_total_match'] = home_total_match
        single_match_item['home_total_point'] = home_total_point
        single_match_item['home_win_pro'] = home_win_pro
        single_match_item['away_total_match'] = away_total_match
        single_match_item['away_total_point'] = away_total_point
        single_match_item['away_win_pro'] = away_win_pro
        single_match_item['home_latest_win_pro'] = home_latest_win_pro
        single_match_item['home_latest_draw_pro'] = home_latest_draw_pro
        single_match_item['home_latest_away_pro'] = home_latest_away_pro
        single_match_item['home_latest_win_handicap_pro'] = home_latest_win_handicap_pro
        single_match_item['home_latest_big_goal_pro'] = home_latest_big_goal_pro
        single_match_item['away_latest_win_pro'] = away_latest_win_pro
        single_match_item['away_latest_draw_pro'] = away_latest_draw_pro
        single_match_item['away_latest_away_pro'] = away_latest_away_pro
        single_match_item['away_latest_win_handicap_pro'] = away_latest_win_handicap_pro
        single_match_item['away_latest_big_goal_pro'] = away_latest_big_goal_pro
        single_match_item['jiaofeng_home_pro'] = jiaofeng_home_pro
        single_match_item['jiaofeng_draw_pro'] = jiaofeng_draw_pro
        single_match_item['jiaofeng_away_pro'] = jiaofeng_away_pro
        single_match_item['jiaofeng_win_handicap_pro'] = jiaofeng_win_handicap_pro
        single_match_item['jiaofeng_big_goal_pro'] = jiaofeng_big_goal_pro
        yield single_match_item


